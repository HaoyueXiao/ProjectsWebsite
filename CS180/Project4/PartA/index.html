<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Panorama</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="./assets/css/main.css" />
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<!-- Lightweight client-side loader that feature-detects and load polyfills only when necessary -->
		<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2/webcomponents-loader.min.js"></script>
		<script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
		<script type="text/javascript" async
			src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js">
		</script>
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<header id="header">
					<h1><a href="https://haoyuexiao.github.io/">Haoyue Xiao</a></h1>
					<nav class="links">
						<ul>
							<li><a href="https://haoyuexiao.github.io/education/education.html">Education</a></li>
							<li><a href="https://haoyuexiao.github.io/projects/projects.html">Projects</a></li>
							<li><a href="https://haoyuexiao.github.io/cv/CV.htmll">CV</a></li>
							<li><a href="https://haoyuexiao.github.io/personal/personal.html">Personal</a></li>
						</ul>
					</nav>
					<nav class="main">
						<ul>
			
							<li class="menu">
								<a class="fa-bars" href="#menu">Menu</a>
							</li>
						</ul>
					</nav>
				</header>

				<!-- Menu -->
					<section id="menu">


						<!-- Links -->
						<section>
							<ul class="links">
								<li>
									<a href="https://haoyuexiao.github.io/education/education.html">
										<h3>Education</h3>
									</a>
								</li>
								<li>
									<a href="https://haoyuexiao.github.io/projects/projects.html">
										<h3>Projects</h3>
									</a>
								</li>
								<li>
									<a href="https://haoyuexiao.github.io/cv/CV.html">
										<h3>CV</h3>
									</a>
								</li>
								<li>
									<a href="https://haoyuexiao.github.io/personal/personal.html">
										<h3>Personal</h3>

									</a>
								</li>
							</ul>
						</section>

						<!-- ## menu -->
						<section>
							<h3>Contents</h3>
							<ul class="toc">
								<li><a href="#part-1-shot-the-pictures">Part 1: Shot the Pictures</a></li>
								<li><a href="#part-2-recover-homographies">Part 2: Recover Homographies</a></li>
								<li><a href="#part-3-rectification">Part 3: Rectification</a></li>
								<li><a href="#part-4-panorama-blending">Part 4: Panorama Blending</a></li>
								<li>
									<a href="#bells-whistles">Bells & Whistles</a>
									<ul>
										<li><a href="#example-feature-1">Example Feature 1</a></li>
										<li>
											<a href="#example-feature-2">Example Feature 2</a>
											<ul>
												<li><a href="#sub-feature-1">Sub Feature 1</a></li>
												<li><a href="#sub-feature-2">Sub Feature 2</a></li>
											</ul>
										</li>
									</ul>
								</li>
							</ul>
						</section>
						

					<!-- Actions -->
						<section>
							<ul class="actions stacked">
								<li><a href="https://haoyuexiao.github.io/email_contact/email.html" class="button large fit">Contact</a></li>
							</ul>
						</section>

				</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="https://haoyuexiao.github.io/ProjectsWebsite/CS180/Project2/"> Panorama</a></h2>
										<p><a href="https://inst.eecs.berkeley.edu/~cs180/fa24/hw/proj2/">CS 180 </a> project 4 Part A</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2024-10-19">October 19, 2024</time>
										<a href="https://haoyuexiao.github.io/" class="author"><span class="name">Haoyue Xiao</span><img src="./images/avatar.png" alt="avatar" /></a>
									</div>
								</header>
								<div style="display: flex; align-items: center; justify-content: center;">
									<span class="image featured"><img src="./images/lr_para.jpg" alt="" /></span>
								</div>
								<div style="padding-left:10px; padding-right:10px">
									<div style="padding-left:10px; padding-right:10px">
										<h3 id="part-1-shot-the-pictures">Part 1: Shot the Pictures</h3>
										<p>I shot 6 images using a Sony \(\alpha 7R4\) camera with a 50mm lens and a tripod. I ensured that each photo has about 40% of overlapped area and can find corresponding points in each image.</p>
										<p>Here are the images for demonstration:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/demo.png" alt="Demonstration Images" /></span>
										</div>
								
										<h3 id="part-2-recover-homographies">Part 2: Recover Homographies</h3>
										<p>I used the tool I implemented in Project 3 to select 10 correspondence points between the third and the fourth images, and here are the points:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/points.png" alt="Correspondence Points" /></span>
										</div>
								
										<p>Now, given the corresponding points in the homogeneous system</p>
										$$
										p = \begin{bmatrix}p_x^{(1)}\\ p_y^{(1)}\\1\end{bmatrix} \quad q = \begin{bmatrix}q_x^{(1)}\\ q_y^{(1)}\\1\end{bmatrix}
										$$
										<p>and the homography matrix</p>
										$$
										H = \begin{bmatrix}h_1&h_2&h_3\\ h_4&h_5&h_6 \\h_7&h_8&1\end{bmatrix}
										$$
										<p>We have</p>
										$$
										Hp = \begin{bmatrix}
										p_x^{(1)}h_1+p_y^{(1)}h_2+h_3\\
										p_x^{(1)}h_4+p_y^{(1)}h_5+h_6\\
										p_x^{(1)}h_7+p_y^{(1)}h_8+1
										\end{bmatrix}
										$$
										<p>Since we are in the homogeneous system, we should divide the first 2 components by the third to get the normalized value in the Cartesian coordinate, and equate that to the target points:</p>
										$$
										\begin{cases}
										\frac{p_x^{(1)}h_1+p_y^{(1)}h_2+h_3}{p_x^{(1)}h_7+p_y^{(1)}h_8+1} = q_x^{(1)}\\
										\frac{p_x^{(1)}h_4+p_y^{(1)}h_5+h_6}{p_x^{(1)}h_7+p_y^{(1)}h_8+1} = q_y^{(1)}
										\end{cases}
										$$
										<p>Simplifying this gives:</p>
										$$
										\begin{cases}
										p_x^{(1)}h_1+p_y^{(1)}h_2+h_3 + 0h_4 + 0h_5 + 0h_6 - q_x^{(1)}p_x^{(1)}h_7 - q_x^{(1)}p_y^{(1)}h_8 = q_x^{(1)}\\
										0h_1 + 0h_2 + 0h_3 + p_x^{(1)}h_4 + p_y^{(1)}h_5 + h_6 - q_y^{(1)}p_x^{(1)}h_7 - q_y^{(1)}p_y^{(1)}h_8 = q_y^{(1)}
										\end{cases}
										$$
										<p>Which further suggests</p>
										$$
										\begin{bmatrix}
										p_x^{(1)} & p_y^{(1)} & 1 & 0 & 0 & 0 & -q_x^{(1)}p_x^{(1)} & -q_x^{(1)}p_y^{(1)}\\
										0 & 0 & 0 & p_x^{(1)} & p_y^{(1)} & 1 & -q_y^{(1)}p_x^{(1)} & -q_y^{(1)}p_y^{(1)}
										\end{bmatrix}
										\begin{bmatrix}h_1\\h_2\\h_3\\h_4\\h_5\\h_6\\h_7\\h_8\end{bmatrix} = \begin{bmatrix}q_x^{(1)}\\ q_y^{(1)}\end{bmatrix}
										$$
										
										<p>Therefore, to solve for \( H \) that accommodates each \( p, q \), we integrate all the points into the matrix</p>
										$$
										A = \begin{bmatrix}
										p_x^{(1)} & p_y^{(1)} & 1 & 0 & 0 & 0 & -q_x^{(1)}p_x^{(1)} & -q_x^{(1)}p_y^{(1)}\\
										0 & 0 & 0 & p_x^{(1)} & p_y^{(1)} & 1 & -q_y^{(1)}p_x^{(1)} & -q_y^{(1)}p_y^{(1)}\\
										\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots\\
										p_x^{(N)} & p_y^{(N)} & 1 & 0 & 0 & 0 & -q_x^{(N)}p_x^{(N)} & -q_x^{(N)}p_y^{(N)}\\
										0 & 0 & 0 & p_x^{(N)} & p_y^{(N)} & 1 & -q_y^{(N)}p_x^{(N)} & -q_y^{(N)}p_y^{(N)}
										\end{bmatrix}
										$$
										<p>and</p>
										$$
										b = [q_x^{(1)}, q_y^{(1)}, \cdots, q_x^{(N)}, q_y^{(N)}]^T
										$$
										<p>and solve \( Ah = b \) using the least squares solver.</p>
										
										<p>Using this approach, we are able to find the \( H \) that transforms <code>pt1</code> to <code>pt2</code> effectively.</p>
										
										<p>Transforming <code>para_3</code> to the points in <code>para_4</code> gives the following image:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/transform.png" alt="Transformed Image" /></span>
										</div>
								
										<h3 id="part-3-rectification">Part 3: Rectification</h3>
										<p>To ensure that our homography works correctly, we can try to rectify an image with a known rectangular object to a standard rectangular shape. Here's a photo of my laptop on my bed.</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/laptop.png" alt="Laptop on Bed" /></span>
										</div>
										
										<p>Due to perspective, it's not standardly rectangular. We can use homography to correct it:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/laptop_c.png" alt="Rectified Laptop Image" /></span>
										</div>
								
										<h3 id="part-4-panorama-blending">Part 4: Panorama Blending</h3>
										<p>Now, given image 1 and image 2, we can use the computed homography to wrap <code>img1</code> perspectively to the plane of <code>img2</code>, but we still need to blend the two images to create a seamless panorama.</p>
										
										<p>Here are the steps to achieve this process:</p>
										<ol>
											<li>Compute the homography \( H \) from <code>pts1</code> and <code>pts2</code>.</li>
											<li>Transform the corner points of <code>img1</code> to get the position of <code>img1</code> in the plane of <code>img2</code>. Use this to get the new canvas size and compute the translation <code>T</code> needed to move the images to the new coordinate.</li>
											<li>Use <code>T</code> and <code>H</code> to wrap <code>img1</code> onto the plane of <code>img2</code>.</li>
											<li>Use threshold masking to find the mask of <code>wrapped_img1</code> and <code>wrapped_img2</code> respectively.</li>
											<li>Compute the alpha masking using distance to the background. Here's one example:</li>
										</ol>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/alpha.png" alt="Alpha Masking Example" /></span>
										</div>
										<ol start="6">
											<li>Use the algorithm from Project 2, with the distanced alpha as the mask, to blend the images using multi-band blending.</li>
										</ol>
								
										<p>Here's the result of combining <code>para_3</code> and <code>para_4</code>:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/paranoma.jpg" alt="Combined Panorama" /></span>
										</div>
										
										<p>And here's the full panorama of combining all 6 images together:</p>
										<div style="display: flex; align-items: center; justify-content: center;">
											<span class="image featured"><img src="./images/full.jpg" alt="Full Panorama" /></span>
										</div>
									</div>
								</div>
								
							</article>

					</div>

				<!-- Footer -->
					<section id="footer">
						<ul class="icons">
							<li><a href="https://www.instagram.com/billxiao1121/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="../../email_contact/email.html" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
							<li><a href="https://github.com/HaoyueXiao" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
							<li><a href="https://www.linkedin.com/in/haoyuexiao-b6810124b/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li>
							<li><a href="#" class="icon brands fa-weixin"><span class="label">WeChat</span></a></li>
						</ul>
						<p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
					</section>

			</div>

		<!-- Scripts -->
			<script src="./assets/js/jquery.min.js"></script>
			<script src="./assets/js/browser.min.js"></script>
			<script src="./assets/js/breakpoints.min.js"></script>
			<script src="./assets/js/util.js"></script>
			<script src="./assets/js/main.js"></script>

	</body>
</html>
